<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSC Analyst Planner 2026</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        serifText: ['Lora', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        bsc: {
                            green: '#005F40', // Màu xanh thương hiệu BSC
                            gold: '#C5A059'
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Styles */
        body {
            background-color: #F1F5F9; /* Slate 100 */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        /* Lined Paper Pattern for Notes (Print Friendly) */
        .lined-paper {
            background-color: #FDFDFD;
            background-image: linear-gradient(#E2E8F0 1px, transparent 1px);
            background-size: 100% 36px; /* Chiều cao dòng kẻ */
            line-height: 36px; 
        }
        
        .lined-input {
            background: transparent;
            width: 100%;
            border: none;
            outline: none;
            padding: 0;
            margin: 0;
            font-family: 'Lora', serif;
            font-size: 15px;
            color: #334155;
            line-height: 36px; 
        }
        
        /* Checkbox Style */
        .custom-checkbox {
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.15em;
            height: 1.15em;
            border: 1px solid #cbd5e1;
            border-radius: 0.15em;
            display: grid;
            place-content: center;
            cursor: pointer;
        }
        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #005F40; /* BSC Green Check */
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }

        /* Print Settings (A4 Landscape) */
        @media print {
            @page { size: A4 landscape; margin: 0; }
            body { background: white; margin: 0; padding: 0; }
            .no-print { display: none !important; }
            .print-container { 
                width: 100vw; 
                height: 100vh; 
                border: none; 
                box-shadow: none; 
                border-radius: 0;
                padding: 5mm 10mm; 
                background: white !important;
            }
            /* Hide generic browser headers/footers if possible, but mainly controlled by user settings */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. CONFIG & ASSETS ---
        const LOGO_BASE64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAABQBAMAAAAgtay6AAAAJFBMVEVHcEwmYakyZ6MnXKpIa5owX6bcpTwSq5ImXKspXKkRr5D8syaoW6H2AAAACHRSTlMAfEG4Ftu/ypTeOakAAAHmSURBVHic7ZVBTsQgFIafTkxKZjPqBRpPoPESLj0SmpjgjrjrrLqeG0x6OV+BR4ECM0Cixsy/aPnp+/hpYRiAi/6ottOsSnhqgLct8NQAb1vgqQHetsAKHFAHVE3wsRK2wRXwElwBL8GV8LEWJv0mvG+BDw3wvgU+BPCt0p1X1Hvuwbb2ISxI3HR0ytHjjftMs2MENhWdcS5Lz8JgBxa+j7gw2IW5ExxzsPrWAZxyguAxAQsTxYHK9V1ddwaGAN7RIBp+9Jwws+caHqNwZ8vBlhMECwx5mIMtp6Fm96HgMQ5DDjaN1bZewcKD3zx4TMDLO/fG8mUeYGA4Cdt97cAJGZg+rFrTvgAm9dbyYpjT7O3UC2DtXxxXMm2/oxDmXg+vgum9z18qcBd4Uwp3DqyH4ufDejc7ixTZnqdhvrgu+GGUwqIMFhEY7+85uFuVr4+hJGwXxx7YfHUAxmBnf6ryTzqB3aP39TQMOZeFab4pl4V9H3EZWA/eeY5lg1N/7nEX6lnL63vy3H2CvOiHNUgGA+AFm7MZrkDijQ0S29iFYtRYSfYMJArgGu9YiDCywOYBGTwqGL1MJWO1pGTQyQqWJhkGFp+2BIKZToZ5IjYZ+2U+eQA1skr+Ul9Aw/pVmbxJvfNF/1/falRpmEp4VcUAAAAASUVORK5CYII=";

        // --- 2. LUNAR LOGIC (Fixed for 2026) ---
        // Mapping of Lunar Month Start Dates for 2026
        const LUNAR_STARTS_2026 = [
            null, 
            "2026-02-17", // 1/1 AL (Tet)
            "2026-03-19", // 1/2 AL
            "2026-04-17", // 1/3 AL
            "2026-05-17", // 1/4 AL
            "2026-06-15", // 1/5 AL
            "2026-07-15", // 1/6 AL
            "2026-08-13", // 1/7 AL
            "2026-09-11", // 1/8 AL
            "2026-10-11", // 1/9 AL
            "2026-11-09", // 1/10 AL
            "2026-12-09", // 1/11 AL
        ];
        
        function getLunarDate2026(solarDateObj) {
            const current = solarDateObj.getTime();
            let monthIndex = -1;
            let startDate = null;
            
            // Handle pre-Tet (Jan & early Feb 2026) -> Lunar 11/12 of 2025
            if (current < new Date("2026-02-17").getTime()) {
                 if (current >= new Date("2026-01-20").getTime()) {
                     startDate = new Date("2026-01-20");
                     monthIndex = 12; // 12/2025 AL
                 } else {
                     startDate = new Date("2025-12-21"); // Approx 11/2025 AL
                     monthIndex = 11;
                 }
            } else {
                for (let i = 1; i < LUNAR_STARTS_2026.length; i++) {
                    const d = new Date(LUNAR_STARTS_2026[i]);
                    if (current >= d.getTime()) {
                        monthIndex = i;
                        startDate = d;
                    } else {
                        break;
                    }
                }
            }
            
            if (!startDate) return { day: 1, month: 1 };
            
            const diffTime = Math.abs(current - startDate.getTime());
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            const lunarDay = diffDays + 1;
            
            return { day: lunarDay, month: monthIndex };
        }

        // --- 3. DATA & UTILS ---
        const STATIC_EVENTS = [
            {"id":1,"date":"2026-01-01","title":"[Nghỉ Lễ] Tết Dương Lịch 2026","description":"Nghỉ lễ toàn quốc","category":"holiday"},
            {"id":2,"date":"2026-01-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: Tổng cục Thống kê","category":"macro_vn"},
            {"id":3,"date":"2026-01-15","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 1","category":"derivatives"},
            {"id":4,"date":"2026-01-19","title":"[VN] ETF: (A) Cập nhật TT","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":5,"date":"2026-01-21","title":"[VN] ETF: (A) Review","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":6,"date":"2026-01-27","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":7,"date":"2026-02-02","title":"[VN] ETF: (E) Hiệu lực","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":8,"date":"2026-02-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":9,"date":"2026-02-17","title":"[Nghỉ Lễ] Tết Nguyên Đán","description":"Mùng 1 Tết","category":"holiday"},
            {"id":10,"date":"2026-02-18","title":"[Nghỉ Lễ] Tết Nguyên Đán","description":"Mùng 2 Tết","category":"holiday"},
            {"id":11,"date":"2026-02-19","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 2","category":"derivatives"},
            {"id":12,"date":"2026-02-27","title":"[QT] ETF Ngoại: Cut-off FTSE","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":13,"date":"2026-03-04","title":"[QT] FTSE: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":14,"date":"2026-03-06","title":"[QT] ETF Ngoại: Cut-off V.E","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":15,"date":"2026-03-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":16,"date":"2026-03-13","title":"[QT] V.E: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":17,"date":"2026-03-17","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":18,"date":"2026-03-19","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 3","category":"derivatives"},
            {"id":19,"date":"2026-03-20","title":"[QT] ETF Ngoại: Review Hiệu lực","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":20,"date":"2026-03-29","title":"[VN] GSO: Báo cáo Quý 1","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":21,"date":"2026-04-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":22,"date":"2026-04-16","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 4","category":"derivatives"},
            {"id":23,"date":"2026-04-20","title":"[VN] ETF: (A) Cập nhật TT","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":24,"date":"2026-04-27","title":"[Nghỉ Lễ] Giỗ Tổ Hùng Vương","description":"10/3 Âm Lịch","category":"holiday"},
            {"id":25,"date":"2026-04-28","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":26,"date":"2026-04-30","title":"[Nghỉ Lễ] Giải phóng Miền Nam","description":"Nghỉ lễ toàn quốc","category":"holiday"},
            {"id":27,"date":"2026-05-01","title":"[Nghỉ Lễ] Quốc tế Lao động","description":"Nghỉ lễ toàn quốc","category":"holiday"},
            {"id":28,"date":"2026-05-04","title":"[VN] ETF: (E) Hiệu lực","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":29,"date":"2026-05-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":30,"date":"2026-05-21","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 5","category":"derivatives"},
            {"id":31,"date":"2026-05-29","title":"[QT] ETF Ngoại: Cut-off FTSE","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":32,"date":"2026-06-03","title":"[QT] FTSE: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":33,"date":"2026-06-05","title":"[QT] ETF Ngoại: Cut-off V.E","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":34,"date":"2026-06-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":35,"date":"2026-06-12","title":"[QT] V.E: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":36,"date":"2026-06-16","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":37,"date":"2026-06-18","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 6","category":"derivatives"},
            {"id":38,"date":"2026-06-19","title":"[QT] ETF Ngoại: Review Hiệu lực","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":39,"date":"2026-06-29","title":"[VN] GSO: Báo cáo Quý 2","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":40,"date":"2026-07-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":41,"date":"2026-07-16","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 7","category":"derivatives"},
            {"id":42,"date":"2026-07-20","title":"[VN] ETF: (A) Cập nhật TT","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":43,"date":"2026-07-22","title":"[VN] ETF: (A) Review","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":44,"date":"2026-07-28","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":45,"date":"2026-08-03","title":"[VN] ETF: (E) Hiệu lực","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":46,"date":"2026-08-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":47,"date":"2026-08-20","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 8","category":"derivatives"},
            {"id":48,"date":"2026-08-28","title":"[QT] ETF Ngoại: Cut-off FTSE","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":49,"date":"2026-09-02","title":"[Nghỉ Lễ] Quốc khánh","description":"Nghỉ lễ toàn quốc","category":"holiday"},
            {"id":50,"date":"2026-09-02","title":"[QT] FTSE: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":51,"date":"2026-09-04","title":"[QT] ETF Ngoại: Cut-off V.E","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":52,"date":"2026-09-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":53,"date":"2026-09-11","title":"[QT] V.E: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":54,"date":"2026-09-15","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":55,"date":"2026-09-17","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 9","category":"derivatives"},
            {"id":56,"date":"2026-09-18","title":"[QT] ETF Ngoại: Review Hiệu lực","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":57,"date":"2026-09-29","title":"[VN] GSO: Báo cáo Quý 3","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":58,"date":"2026-10-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":59,"date":"2026-10-15","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 10","category":"derivatives"},
            {"id":60,"date":"2026-10-19","title":"[VN] ETF: (A) Cập nhật TT","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":61,"date":"2026-10-21","title":"[VN] ETF: (A) Review","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":62,"date":"2026-10-27","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":63,"date":"2026-10-28","title":"[QT] ECB: Họp CS Tiền tệ","description":"Nguồn: ECB","category":"macro_global"},
            {"id":64,"date":"2026-11-02","title":"[VN] ETF: (E) Hiệu lực","description":"Nguồn: ETF Nội","category":"etf"},
            {"id":65,"date":"2026-11-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":66,"date":"2026-11-19","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 11","category":"derivatives"},
            {"id":67,"date":"2026-11-27","title":"[QT] ETF Ngoại: Cut-off FTSE","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":68,"date":"2026-12-02","title":"[QT] FTSE: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":69,"date":"2026-12-04","title":"[QT] ETF Ngoại: Cut-off V.E","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":70,"date":"2026-12-06","title":"[VN] GSO: Báo cáo KT-XH","description":"Nguồn: GSO","category":"macro_vn"},
            {"id":71,"date":"2026-12-08","title":"[QT] FED: Họp CS Tiền tệ","description":"Nguồn: FED","category":"macro_global"},
            {"id":72,"date":"2026-12-09","title":"[QT] ECB: Họp CS Tiền tệ","description":"Nguồn: ECB","category":"macro_global"},
            {"id":73,"date":"2026-12-11","title":"[QT] V.E: Công bố Review","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":74,"date":"2026-12-17","title":"[VN] Futures VN30 đáo hạn","description":"Đáo hạn Phái sinh Tháng 12","category":"derivatives"},
            {"id":75,"date":"2026-12-18","title":"[QT] ETF Ngoại: Review Hiệu lực","description":"Nguồn: ETF Ngoại","category":"etf"},
            {"id":76,"date":"2026-12-29","title":"[VN] GSO: Báo cáo Quý 4","description":"Nguồn: GSO","category":"macro_vn"}
        ];

        const getSmartBadge = (title, category) => {
            let short = title
                .replace('[VN]', '')
                .replace('[QT]', '')
                .replace('[Nghỉ Lễ]', '')
                .trim();
            
            if (category === 'macro_global') {
                if (short.includes('FED')) return 'FED: Policy';
                if (short.includes('ECB')) return 'ECB: Policy';
            }
            if (category === 'macro_vn') {
                if (short.includes('GSO') && short.includes('Quý')) return 'GSO: GDP/CPI (Q)';
                if (short.includes('GSO')) return 'GSO: Macro Data';
            }
            if (category === 'derivatives') return 'PS: Đáo Hạn';
            if (category === 'etf') {
                if (short.includes('FTSE') && short.includes('Review')) return 'FTSE: Review';
                if (short.includes('V.E') && short.includes('Review')) return 'V.E: Review';
                if (short.includes('Cập nhật')) return 'ETF: Update';
                if (short.includes('Hiệu lực')) return 'ETF: Effective';
                if (short.includes('Cut-off')) return 'ETF: Cut-off';
                if (short.includes('Review')) return 'ETF: Review';
            }
            if (category === 'holiday') return short;
            return short.length > 15 ? short.substring(0, 15) + '..' : short;
        };

        const getCategoryColor = (cat) => {
            switch(cat) {
                case 'holiday': return 'bg-rose-100 text-rose-800 border-rose-200';
                case 'macro_global': return 'bg-indigo-100 text-indigo-800 border-indigo-200';
                case 'macro_vn': return 'bg-emerald-100 text-emerald-800 border-emerald-200';
                case 'etf': return 'bg-slate-100 text-slate-700 border-slate-200';
                case 'derivatives': return 'bg-amber-100 text-amber-800 border-amber-200';
                case 'personal': return 'bg-sky-100 text-sky-800 border-sky-200';
                default: return 'bg-gray-100 text-gray-800 border-gray-200';
            }
        };

        // --- 4. ICONS ---
        const Icons = {
            Left: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"/></svg>,
            Right: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"/></svg>,
            Plus: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4"></path></svg>,
            Printer: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>,
            Save: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>,
            Upload: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>,
            X: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/></svg>,
        };

        // --- 5. MAIN APP ---
        function App() {
            const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1));
            const [customEvents, setCustomEvents] = useState([]);
            const [notes, setNotes] = useState(() => {
                return Array(13).fill({ text: '', done: false }).map((_, i) => ({ id: i, text: '', done: false }));
            });
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [newEvent, setNewEvent] = useState({ date: '', title: '' });

            // Load/Save
            useEffect(() => {
                const e = localStorage.getItem('planner_ev_26');
                const n = localStorage.getItem('planner_nt_26');
                if (e) setCustomEvents(JSON.parse(e));
                if (n) setNotes(JSON.parse(n));
            }, []);
            useEffect(() => {
                localStorage.setItem('planner_ev_26', JSON.stringify(customEvents));
                localStorage.setItem('planner_nt_26', JSON.stringify(notes));
            }, [customEvents, notes]);

            const allEvents = [...STATIC_EVENTS, ...customEvents];

            // Handlers
            const handleAddCustomEvent = () => {
                if (!newEvent.title || !newEvent.date) return;
                setCustomEvents([...customEvents, { 
                    id: 'c-'+Date.now(), 
                    date: newEvent.date, 
                    title: newEvent.title, 
                    description: 'Sự kiện cá nhân', 
                    category: 'personal' 
                }]);
                setIsAddModalOpen(false);
                setNewEvent({ date: '', title: '' });
            };

            const handleDeleteCustomEvent = (id) => {
                if(window.confirm("Delete this event?")) {
                    setCustomEvents(customEvents.filter(e => e.id !== id));
                    setSelectedEvent(null);
                }
            }

            const handleBackup = () => {
                const data = JSON.stringify({ events: customEvents, notes });
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = 'BSC_Planner_Backup.json'; a.click();
            };

            const handleRestore = (e) => {
                const file = e.target.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const d = JSON.parse(evt.target.result);
                        if(d.events) setCustomEvents(d.events);
                        if(d.notes) setNotes(d.notes);
                        alert("Data restored!");
                    } catch(err) { alert("Invalid File"); }
                };
                reader.readAsText(file);
            };

            // Grid Logic
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = (new Date(year, month, 1).getDay() + 6) % 7; 
            const days = Array(firstDay).fill(null).concat(
                Array.from({length: daysInMonth}, (_, i) => new Date(year, month, i + 1))
            );

            return (
                <div className="w-full h-screen flex flex-col items-center pt-8 pb-8 print:p-0 print:h-auto">
                    <div className="print-container w-[1200px] h-full bg-[#FDFDFD] shadow-soft rounded-xl overflow-hidden flex flex-col border border-slate-200">
                        
                        {/* HEADER TOOLBAR */}
                        <header className="px-8 py-5 flex justify-between items-center border-b border-slate-100 bg-white no-print">
                            <div className="flex items-center gap-4">
                                <img src={LOGO_BASE64} alt="BSC Logo" className="h-10 w-auto object-contain" />
                                <div className="h-8 w-px bg-slate-200 mx-2"></div>
                                <div>
                                    <h1 className="font-serif text-xl font-bold text-slate-800 leading-none">Planner 2026</h1>
                                    <p className="font-mono text-[10px] text-slate-400 mt-1 uppercase tracking-widest">Financial Research</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsAddModalOpen(true)} className="flex items-center gap-2 px-3 py-2 text-xs font-medium text-slate-600 hover:bg-slate-50 border border-slate-200 rounded-lg transition">
                                    <Icons.Plus /> Add Event
                                </button>
                                <label className="flex items-center gap-2 px-3 py-2 text-xs font-medium text-slate-600 hover:bg-slate-50 border border-slate-200 rounded-lg transition cursor-pointer">
                                    <Icons.Upload /> Restore
                                    <input type="file" className="hidden" accept=".json" onChange={handleRestore} />
                                </label>
                                <button onClick={handleBackup} className="flex items-center gap-2 px-3 py-2 text-xs font-medium text-slate-600 hover:bg-slate-50 border border-slate-200 rounded-lg transition">
                                    <Icons.Save /> Backup
                                </button>
                                <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 text-xs font-bold text-white bg-[#005F40] hover:bg-[#004d34] rounded-lg transition shadow-sm ml-2">
                                    <Icons.Print /> Print A4
                                </button>
                            </div>
                        </header>

                        {/* PRINT ONLY HEADER (Alternative Header) */}
                        <div className="hidden print:flex px-8 py-6 justify-between items-center border-b border-slate-100">
                             <img src={LOGO_BASE64} alt="BSC Logo" className="h-12 w-auto object-contain" />
                             <div className="text-right">
                                <h1 className="font-serif text-2xl font-bold text-slate-800">2026 Planner</h1>
                                <p className="font-sans text-xs text-slate-500">BSC Securities • Research Dept</p>
                             </div>
                        </div>

                        {/* MAIN CONTENT */}
                        <div className="flex-1 flex overflow-hidden">
                            {/* CALENDAR (LEFT) */}
                            <div className="flex-[2] border-r border-slate-200 flex flex-col p-6 bg-white">
                                <div className="flex justify-between items-end mb-5">
                                    <div>
                                        <h2 className="text-3xl font-serif font-bold text-slate-900 capitalize">
                                            {currentDate.toLocaleString('vi-VN', { month: 'long' })}
                                        </h2>
                                        <p className="text-lg font-serif italic text-slate-400">{year}</p>
                                    </div>
                                    <div className="flex gap-2 no-print">
                                        <button onClick={() => setCurrentDate(new Date(year, month - 1))} className="p-1.5 hover:bg-slate-100 rounded-full text-slate-400"><Icons.Left /></button>
                                        <button onClick={() => setCurrentDate(new Date(year, month + 1))} className="p-1.5 hover:bg-slate-100 rounded-full text-slate-400"><Icons.Right /></button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-7 mb-2 border-b border-slate-100 pb-2">
                                    {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(d => (
                                        <div key={d} className="text-center font-mono text-[10px] font-bold text-slate-400 uppercase tracking-widest">{d}</div>
                                    ))}
                                </div>

                                <div className="flex-1 grid grid-cols-7 auto-rows-fr gap-px bg-slate-100 border border-slate-100">
                                    {days.map((d, i) => {
                                        if (!d) return <div key={i} className="bg-white"></div>;
                                        const dStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
                                        const events = allEvents.filter(e => e.date === dStr);
                                        const lunar = getLunarDate2026(d);
                                        const isMajor = lunar.day === 1 || lunar.day === 15;
                                        const isToday = new Date().toDateString() === d.toDateString();

                                        return (
                                            <div key={i} className={`bg-white p-1.5 flex flex-col group transition hover:bg-slate-50 min-h-[80px]`}>
                                                <div className="flex justify-between items-baseline mb-1">
                                                    <span className={`font-mono text-base leading-none ${isToday ? 'text-[#005F40] font-bold' : 'text-slate-700'}`}>{d.getDate()}</span>
                                                    <span className={`font-serif text-[9px] ${isMajor ? 'text-[#C5A059] font-bold' : 'text-slate-400'}`}>
                                                        {lunar.day}/{lunar.month}
                                                    </span>
                                                </div>
                                                <div className="flex flex-col gap-0.5 overflow-hidden">
                                                    {events.slice(0, 4).map(ev => (
                                                        <div key={ev.id} 
                                                             onClick={() => setSelectedEvent({...ev, lunarStr: `${lunar.day}/${lunar.month} ÂL`})}
                                                             className={`truncate text-[9px] px-1 rounded-sm border-l-2 cursor-pointer font-medium leading-tight py-0.5 ${getCategoryColor(ev.category)}`}
                                                        >
                                                            {getSmartBadge(ev.title, ev.category)}
                                                        </div>
                                                    ))}
                                                    {events.length > 4 && <span className="text-[8px] text-slate-300 pl-1">+{events.length - 4} more</span>}
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>

                            {/* NOTES (RIGHT) */}
                            <div className="flex-1 bg-[#FDFDFD] flex flex-col relative print:border-none">
                                <div className="px-8 pt-8 pb-4">
                                    <h3 className="font-serif font-bold text-xl text-slate-800">Notes</h3>
                                    <p className="font-mono text-[10px] text-slate-400 uppercase tracking-widest mt-0.5">Focus & Priorities</p>
                                </div>
                                
                                <div className="flex-1 lined-paper px-8 overflow-y-auto">
                                    {notes.map(note => (
                                        <div key={note.id} className="flex items-center w-full h-[36px] gap-3">
                                            <input type="checkbox" checked={note.done} 
                                                   onChange={e => {
                                                       const newNotes = notes.map(n => n.id === note.id ? {...n, done: e.target.checked} : n);
                                                       setNotes(newNotes);
                                                   }}
                                                   className="custom-checkbox no-print" />
                                            <input 
                                                className={`lined-input ${note.done ? 'line-through text-slate-300' : ''}`} 
                                                value={note.text}
                                                onChange={e => {
                                                    const newNotes = notes.map(n => n.id === note.id ? {...n, text: e.target.value} : n);
                                                    setNotes(newNotes);
                                                }}
                                            />
                                        </div>
                                    ))}
                                    {/* Padding lines for print */}
                                    <div className="w-full h-[36px] print:block hidden"></div>
                                    <div className="w-full h-[36px] print:block hidden"></div>
                                    <div className="w-full h-[36px] print:block hidden"></div>
                                </div>

                                {/* Minimal Footer */}
                                <div className="p-4 text-center">
                                    <p className="font-mono text-[9px] text-slate-300">© 2026 BSC Research</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* EVENT DETAILS MODAL */}
                    {selectedEvent && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 no-print" onClick={() => setSelectedEvent(null)}>
                            <div className="bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden animate-[fadeIn_0.15s_ease-out]" onClick={e => e.stopPropagation()}>
                                <div className={`p-5 ${getCategoryColor(selectedEvent.category).split(' ')[0]} bg-opacity-30`}>
                                    <div className="flex justify-between items-start">
                                        <span className="text-[10px] font-bold uppercase tracking-wider bg-white/80 px-2 py-0.5 rounded text-slate-700">
                                            {selectedEvent.category}
                                        </span>
                                        <button onClick={() => setSelectedEvent(null)} className="text-slate-600 hover:text-black"><Icons.X /></button>
                                    </div>
                                    <h3 className="font-serif font-bold text-lg text-slate-900 mt-2">{selectedEvent.title}</h3>
                                </div>
                                <div className="p-5">
                                    <div className="flex gap-4 mb-4">
                                        <div className="flex-1 p-2 bg-slate-50 rounded border border-slate-100 text-center">
                                            <div className="text-[10px] text-slate-400 uppercase">Dương</div>
                                            <div className="font-bold text-slate-800">{selectedEvent.date}</div>
                                        </div>
                                        <div className="flex-1 p-2 bg-amber-50 rounded border border-amber-100 text-center">
                                            <div className="text-[10px] text-amber-500 uppercase">Âm</div>
                                            <div className="font-bold text-amber-800 font-serif">{selectedEvent.lunarStr}</div>
                                        </div>
                                    </div>
                                    <p className="text-sm text-slate-600 font-serif mb-6">{selectedEvent.description}</p>
                                    
                                    <div className="flex gap-2">
                                        <button onClick={() => {
                                            const idx = notes.findIndex(n => !n.text);
                                            if (idx !== -1) {
                                                const newNotes = [...notes];
                                                newNotes[idx].text = `[Note] ${selectedEvent.title}`;
                                                setNotes(newNotes);
                                                setSelectedEvent(null);
                                            }
                                        }} className="flex-1 py-2 bg-[#005F40] text-white rounded-lg text-sm font-medium hover:bg-[#004d34]">
                                            + Add to Notes
                                        </button>
                                        {selectedEvent.category === 'personal' && (
                                            <button onClick={() => handleDeleteCustomEvent(selectedEvent.id)} className="px-3 py-2 bg-rose-100 text-rose-700 rounded-lg hover:bg-rose-200">
                                                <Icons.Trash />
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ADD EVENT MODAL */}
                    {isAddModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 no-print">
                            <div className="bg-white w-full max-w-sm rounded-xl p-6 shadow-2xl">
                                <h3 className="font-serif font-bold text-lg mb-4">Thêm sự kiện mới</h3>
                                <div className="space-y-3">
                                    <input type="date" className="w-full border p-2 rounded text-sm font-sans" 
                                           value={newEvent.date} onChange={e => setNewEvent({...newEvent, date: e.target.value})} />
                                    <input type="text" className="w-full border p-2 rounded text-sm font-sans" placeholder="Tên sự kiện..." 
                                           value={newEvent.title} onChange={e => setNewEvent({...newEvent, title: e.target.value})} />
                                    <div className="flex gap-2 pt-2">
                                        <button onClick={() => setIsAddModalOpen(false)} className="flex-1 py-2 border rounded text-sm hover:bg-slate-50">Hủy</button>
                                        <button onClick={handleAddCustomEvent} className="flex-1 py-2 bg-[#005F40] text-white rounded text-sm hover:bg-[#004d34]">Lưu</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
